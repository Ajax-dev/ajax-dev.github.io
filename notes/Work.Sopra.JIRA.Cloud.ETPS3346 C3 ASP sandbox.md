---
id: coiawea0egy7c7ed9nkar8i
title: ETPS3346 C3 ASP sandbox
desc: ''
updated: 1699365971383
created: 1698926861996
---
### Problems
- Deleted the pod manually in `test-applications` and kept `crashloopbackoff` and wouldn't restart

The cognito pool is already defined:
[In prod infrastructure](https://bitbucket.apak.delivery/projects/IN/repos/prod-infrastructure-tf/browse/main.tf#531-539), apparently this can cause a headache. However, on further inspection I simply need to follow the [Initial Setup after the cognito setup](https://confluence.apak.com/live/display/WIKI/Initial+Tenant+Setup)
- First create the [Standard Tenant Definition](https://confluence.apak.com/live/display/WIKI/Standard+Tenant+Definition) - so first I raised an INF Jira with description as follows
```
As a cognito pool is already defined for C3, following the standard initial tenant setup on confluence.

Please create the Tenant Definition for C3

Follow the instructions on Standard Tenant Definition

Details:

Tenant: c3
Customer: C3
Region: eu-west-1
Subdomain: c3-test-asp
Tenant Name: Daimler
Client Email Identifier Pattern: @mercedes-benz\.com$ ##doesn't need string pattern match before
Client Captive Identifier Use: false ##means "are there any users in the tenant who's emails don't match the pattern"
```
Don't need to create namespace PR as it will be autogenerated from tenant definition provided the name i.e. `c3-test` is in the namespaces

- Second create Kubernetes namesapce and argo policies: [JIRA ticket](https://jira.apak.com/browse/INF-3245)

### Steps
Basically it was following the initial tenant setup but without the `prod` steps as we don't know if this will ever go to prod, also *Christopher Wall* created an empty repository inside the [AWS EKS EU West 1 Non-Prod repo](https://bitbucket.apak.delivery/projects/EUW1NP)

- First thing was creating the tenant definition in the APAK VELA repo via the cloud deploy tool, main changes that happened was email identifier from `@daimler\.com$` to `@mercedes-benz\.com$`

### Cloud deploy
Had to update the `Cloud-Deploy-Template` to allow C3 to be generated from it:
```yaml
deploy-eu-c3:
    tasks:
      create_env:
        description: "Create C3 test environment {}"
        type: git
        template: environment_definition
        repo: ssh://git@bitbucket.apak.delivery:7999/euw1np/c3.git
        filemappings:
          - applications/* > applications/
          - resources/* > resources/
    overrides:
      tenant: c3
      customer: C3
      description: C3 Testing Environment
      servicenamespace: c3-test
      environmentidentifier: sfpw-1
      subdomain: c3-test-sfpw-1
```

- Create tenant definition [INF-3244](https://jira.apak.com/browse/INF-3244)
- Create ArgoCD apps and project for c3-test
- Add c3 to cloud deployment template
- Add delete permission to support role for c3 environment [INF-3251](https://jira.apak.com/browse/INF-3251)
- Update ArgoCD overlays with c3-test
- Create c3 environment c3-test-asp


### Problem shooting
[Identifying cloud env issues](https://confluence.apak.com/live/display/WIKI/Identifying+Cloud+Environment+deployment+issues)

- Generally, if something is wrong, Argo will show it on the *object* itself or via a *sync error*
- If an *object is complaining that another object is missing/wrong* and the other has a green tick. check the live manifest
  - Some will show "synced" but have a **status** field that shows an error
- Sometimes error is in something called an `Operator`, this is objects in Argo depending on another program to do the work, if the object erro is linked to: `Service Registration Controller, Vault Secret Operator, Cloud Integration Controller, DB Schema Controller` go to James Reynolds or Chris Wall