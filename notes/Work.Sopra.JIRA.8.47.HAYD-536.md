---
id: xhe0krku6pwkln08noaiwb3
title: HAYD-536
desc: ''
updated: 1701710840948
created: 1700501147160
---
### Setup new webapp
Using the `setup_new_webapp` script as this is stability branch `.388`, follow and use the *snakecase*, and the path to the folder `C:\Users\alexajones2\git\wfs-388`

```cmd
Name of app in snake case [e.g. test_app]: wfs_388

Attempting to create directory wfs_388 in current directory...

Directory does not exist. Creating directory wfs_388...

Directory wfs_388 created in current directory.

Creating scripts in wfs_388 directory...

Scripts for wfs_388 created.

Creating .properties files in wfs_388 directory ...
Persisting property APP_NAME=wfs_388 to wfs_388/run_wfs_388.properties...

Path to your app's repo [e.g. C:\Users\user\git\WFS]: C:\Users\alexajones2\git\wfs-388
Persisting property APP_HOME=C:\Users\alexajones2\git\wfs-388 to wfs_388/run_wfs_388.properties...

Folder name of module to be deployed [e.g. wfs-ui, or blank if not a multi-module maven project]: wfs-ui
Persisting property DEPLOYMENT_MODULE=wfs-ui to wfs_388/run_wfs_388.properties...

Fully qualified path to exploded war (leave empty if generated by maven)
[e.g. C:\Users\user\git\wfs\wfs-ui\target\wfs-ui-8.70-SNAPSHOT]:
Persisting property WAR_PATH= to wfs_388/run_wfs_388.properties...

Path to web application content root (directory where .xhtml files are located, relative to application root): wfs-ui\WebRoot
Persisting property WEBROOT=wfs-ui\WebRoot to wfs_388/run_wfs_388.properties...

Path to JDK (leave empty if using your default JAVA_HOME environment variable):
Persisting property JDK_PATH= to wfs_388/run_wfs_388.properties...

Path to Maven (leave empty if using your default M2_HOME environment variable)
Persisting property MAVEN_HOME= to wfs_388/run_wfs_388.properties...

HTTP port to access application [defaults to 8080 if left blank]: 8091
Persisting property HTTP_PORT=8091 to wfs_388/run_wfs_388.properties...

The debug port exposed to connect a debugger to the running web application [defaults to 8000 if left blank]:

Context path for URL (i.e. http:://localhost:8091/<context path>) [defaults to WFS_388 if left blank]:
Persisting property CONTEXT_PATH=WFS_388 to wfs_388/run_wfs_388.properties...

Setting Catalina base directory to $HOME/servers/$CONTEXT_PATH-tomcat...
Persisting property CATALINA_BASE_DIR=$HOME/servers/$CONTEXT_PATH-tomcat to wfs_388/run_wfs_388.properties...
Resolving operating system...Persisting property OS=WINDOWS to wfs_388/run_wfs_388.properties...
Setup completed

If you wish to amend any of the properties, you may manually edit the run_wfs_388.properties file under the newly created wfs_388 directory.
You may also want to refer to script.properties at the root of this repo to edit properties that can be applied to all apps running on tomcat via these scripts.
Properties in script.properties which are also defined in run_wfs_388.properties will be overwritten, so you can manually define those variables in run_wfs_388.properties in case you missed any during the setup.
Lastly, you may want to review run_wfs_388.properties and script.properties to check if you have incorrectly entered any of the properties.

To deploy your web app, navigate to the new wfs_388 directory under scripts in your bash and try running ./run_wfs_388
```

### Running locally
- Max sent a csv with the relevant data, to do this go into co-authorisation, something along EDL file upload and upload 
- Ran the tomcat script, but when running `./run_wfs_388 start` had problems due to it being on shutdown port **8005** which is used by a windows process, go into tomcat folder in servers and go to `conf/server.xml` and change to **8090**.
- Was running into 
- Have made it so HoB uses SYSX_USER, 578 uses SYS_USER2, and 388 uses SYSX_USER3 (pain was trying to use SYSX_USER1, which didn't exist) see pain points

### Cloud
[haydock env c100](https://c100-batest.apak.delivery/portal.faces)
- 201A plan has same BR as the 201i (problem plan) viewed through `finance plans > 201i > edit > look in the asset section`


### Layout of C100-BATEST
```mermaid
flowchart LR;
    plan[Plan = 201i]
    profile[Profile = USED_WHOLESALE_PROFILE]
    product[Product = WHOLESALE_PRODUCT]
    plan --> profile --> product

```


### Problem
- Recreated locally by checking business rules at Product level, saw that the `VALIDATE_VEHICLE_AGE_AT_START` rule was there 3 times with `FEED` `ONLINE` `FEED_LOAD` for a min month of 0 and max of 120 and a type of rejection, put this into my local as the crux of the ticket was 10year+ old cars not being rejected 


### Patrick's response to BA
So I had a look with Alex at this and we're not any closer to figuring out what went wrong. The age at start business rule on our test environments and locally  seems to be triggering as expected if we send in csv loads where the reg_date is older than 120 months. 
The logs for the units they complained about seem to be in line with what went on in the U.I where we had certain alerts raised but not the AGE_AT_START 
([logs for the curious ones amongst you](https://kibana.apak.delivery/app/discover#/context/6f1b5520-3084-11ea-8158-13cf6e6ef45b/OsHSt4oBiISXjp-XPT5f?_g=(filters:!())&_a=(columns:!(host,level,message,thread),filters:!(('$state':(store:appState),meta:(alias:!n,disabled:!f,index:'6f1b5520-3084-11ea-8158-13cf6e6ef45b',key:host,negate:!f,params:(query:prod-c100),type:phrase),query:(match_phrase:(host:prod-c100))),('$state':(store:appState),meta:(alias:!n,disabled:!t,index:'6f1b5520-3084-11ea-8158-13cf6e6ef45b',key:message,negate:!f,params:!(ET12RZB,SALLSAAG5DA764536),type:phrases,value:'ET12RZB,%20SALLSAAG5DA764536'),query:(bool:(minimum_should_match:1,should:!((match_phrase:(message:ET12RZB)),(match_phrase:(message:SALLSAAG5DA764536))))))),predecessorCount:10,sort:!(datetime,desc),successorCount:30))). 
Unfortunately quite difficult to figure out what went wrong when we can't recreate it and the logs don't point to any reasons why this business rule was not triggered. 
 
As Alex mentioned, unless they've messed around with their business rules we are out of ideas for now. Unsure if the invoice_date_backdated business rule somehow had an impact on this at all, but thats all our theories for now